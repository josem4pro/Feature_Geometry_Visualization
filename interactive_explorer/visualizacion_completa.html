<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador Completo - Geometría del Espacio Latente GPT-2</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        .header { text-align: center; margin-bottom: 30px; }
        h1 { color: #4fc3f7; font-size: 2.2em; margin-bottom: 10px; }
        h2 { color: #4fc3f7; font-size: 1.5em; margin: 30px 0 20px 0; border-bottom: 2px solid #4fc3f7; padding-bottom: 10px; }
        .subtitle { color: #90a4ae; font-size: 1.1em; }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .stat-box {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px 30px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-value { font-size: 2em; font-weight: bold; color: #4fc3f7; }
        .stat-label { color: #90a4ae; margin-top: 5px; }

        .section {
            max-width: 1400px;
            margin: 0 auto 40px auto;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .chart-container {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .chart-title { color: #4fc3f7; font-size: 1.1em; margin-bottom: 8px; font-weight: 600; }
        .chart-desc { color: #90a4ae; font-size: 0.85em; margin-bottom: 12px; line-height: 1.4; }

        canvas.chart { width: 100% !important; height: 300px !important; }
        canvas.view-2d { display: block; background: #0d1117; border-radius: 8px; width: 100%; }

        #helix-3d-container {
            width: 100%;
            height: 500px;
            border-radius: 8px;
            overflow: hidden;
            background: #0d1117;
        }

        .finding {
            background: rgba(79, 195, 247, 0.1);
            border-left: 4px solid #4fc3f7;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .finding h3 { color: #4fc3f7; margin: 0 0 10px 0; }

        .info-box {
            background: rgba(255,200,0,0.1);
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #666;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .footer a { color: #4fc3f7; }
        .nav-link {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid #4fc3f7;
            border-radius: 8px;
            color: #4fc3f7;
            text-decoration: none;
            margin: 5px;
        }
        .nav-link:hover { background: rgba(79, 195, 247, 0.3); }
    </style>
</head>
<body>
    <div class="header">
        <h1>Explorador de Geometría del Espacio Latente</h1>
        <p class="subtitle">Visualización interactiva de las representaciones internas de GPT-2</p>
        <p class="subtitle">Modelo: GPT-2 | 12 Capas | 768 Dimensiones</p>
        <div style="margin-top: 20px;">
            <a href="helice_real_gpt2.html" class="nav-link">Helice Real (1023 pos)</a>
            <a href="ejemplos/ejemplo_1/ejemplo_paper_1.html" class="nav-link">Ver Ejemplo 1</a>
            <a href="helix_2d.html" class="nav-link">Ver Helice 2D</a>
        </div>
    </div>

    <div class="stats">
        <div class="stat-box">
            <div class="stat-value" id="stat-pos0">--</div>
            <div class="stat-label">Norma Posición 0</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="stat-other">--</div>
            <div class="stat-label">Norma Otras Posiciones</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="stat-ratio">--</div>
            <div class="stat-label">Proporción</div>
        </div>
    </div>

    <!-- Sección 1: Hallazgo Principal -->
    <div class="section">
        <div class="finding">
            <h3>Hallazgo Principal: Alta Norma en Posición 0</h3>
            <p>Los estados latentes en la primera posición de cada secuencia tienen normas significativamente más altas.
            Esto funciona como un <strong>término de sesgo aprendido</strong> - una "pizarra de notas" que el modelo usa para información global.</p>
        </div>
    </div>

    <!-- Sección 2: Gráficos de Normas -->
    <div class="section">
        <h2>Análisis de Normas</h2>
        <div class="grid-2">
            <div class="chart-container">
                <div class="chart-title">Norma por Posición en la Secuencia</div>
                <div class="chart-desc">Norma L2 promedio en cada posición. Observa el pico dramático en la posición 0.</div>
                <canvas id="normByPos" class="chart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">Norma por Capa del Modelo</div>
                <div class="chart-desc">La norma aumenta progresivamente a través de las capas.</div>
                <canvas id="normByLayer" class="chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Sección 3: Separación Atención vs MLP -->
    <div class="section">
        <h2>Separación Geométrica: Atención vs MLP</h2>
        <div class="finding">
            <h3>Hallazgo: Regiones Distintas en el Espacio</h3>
            <p>Las salidas de <strong style="color:#4fc3f7">Atención (azul)</strong> y
            <strong style="color:#f44336">MLP (rojo)</strong> ocupan regiones geométricamente distintas.
            El modelo organiza estos dos tipos de procesamiento en "zonas" separadas del espacio latente.</p>
        </div>
        <div class="grid-2">
            <div class="chart-container">
                <div class="chart-title">Separación Atención vs MLP (PCA)</div>
                <div class="chart-desc">Proyección 2D mostrando cómo las salidas de Atención y MLP se separan naturalmente.</div>
                <canvas id="attnMLP" class="chart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">Evolución de las Capas (PCA)</div>
                <div class="chart-desc">Trayectoria de los estados latentes desde el embedding inicial hasta la capa final.</div>
                <canvas id="layerPCA" class="chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Sección 4: Hélice 3D -->
    <div class="section">
        <h2>Estructura Helicoidal de los Embeddings Posicionales</h2>
        <div class="finding">
            <h3>Hallazgo Fascinante: Los Embeddings Forman una Hélice</h3>
            <p>Los embeddings posicionales aprendidos de GPT-2 forman una <strong>estructura helicoidal</strong>
            en el espacio de alta dimensión. Esta estructura emergió naturalmente durante el entrenamiento -
            nadie le dijo al modelo que organizara las posiciones así.</p>
        </div>

        <div class="chart-container">
            <div class="chart-title">Hélice 3D Interactiva</div>
            <div class="chart-desc">Arrastra para rotar | Scroll para zoom | Los colores van de azul (posición 0) a amarillo (posición 255)</div>
            <div id="helix-3d-container"></div>
        </div>
    </div>

    <!-- Sección 5: Vistas 2D de la Hélice -->
    <div class="section">
        <h2>Vistas 2D de la Hélice (Proyecciones)</h2>
        <div class="info-box">
            <strong>Tip:</strong> Estas vistas 2D muestran la misma hélice desde tres ángulos diferentes,
            permitiendo apreciar su estructura tridimensional completa.
        </div>
        <div class="grid-3">
            <div class="chart-container">
                <div class="chart-title">Vista Frontal (XY)</div>
                <div class="chart-desc">Proyección sobre los componentes principales 1 y 2</div>
                <canvas id="canvas-xy" class="view-2d" width="350" height="300"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">Vista Superior (XZ)</div>
                <div class="chart-desc">Proyección sobre los componentes principales 1 y 3</div>
                <canvas id="canvas-xz" class="view-2d" width="350" height="300"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">Vista Lateral (YZ)</div>
                <div class="chart-desc">Proyección sobre los componentes principales 2 y 3</div>
                <canvas id="canvas-yz" class="view-2d" width="350" height="300"></canvas>
            </div>
        </div>
    </div>

    <!-- Sección 6: Resumen -->
    <div class="section">
        <h2>¿Qué Significa Todo Esto?</h2>
        <div class="finding">
            <h3>El "Cerebro" de GPT-2 Tiene Geometría</h3>
            <p>Estas visualizaciones revelan que GPT-2 no es una "caja negra" caótica. Internamente tiene una <strong>geometría organizada</strong>:</p>
            <ul>
                <li><strong>Usa la primera posición de forma especial</strong> - como memoria temporal para información global</li>
                <li><strong>Separa el trabajo de Atención y MLP</strong> - en regiones distintas del espacio mental</li>
                <li><strong>Representa las posiciones como una hélice</strong> - una estructura elegante que emergió del entrenamiento</li>
            </ul>
            <p>Es como descubrir que la IA desarrolló su propia "arquitectura mental" que nadie le enseñó explícitamente.</p>
        </div>
    </div>

    <div class="footer">
        <p>Basado en: <strong>"Visualizing LLM Latent Space Geometry Through Dimensionality Reduction"</strong></p>
        <p>Ning, Rangaraju & Kuo (2025) | <a href="https://arxiv.org/abs/2511.21594">arXiv:2511.21594</a></p>
    </div>

    <script>
        // ============================================
        // DATOS (valores de ejemplo - se actualizan con datos reales)
        // ============================================

        // Datos de normas (ejemplo)
        const normByPosData = [890, 285, 278, 275, 272, 270, 268, 266, 265, 264, 263, 262, 261, 260, 259, 258, 257, 256, 255, 254, 253, 252, 251, 250, 249, 248, 247, 246, 245, 244];
        const normByLayerData = [45, 85, 95, 105, 140, 155, 165, 200, 215, 230, 250, 290, 310, 330, 355, 395, 410, 430, 460, 490, 510, 530, 560, 595, 610];

        // Estadísticas
        document.getElementById('stat-pos0').textContent = '890';
        document.getElementById('stat-other').textContent = '260';
        document.getElementById('stat-ratio').textContent = '3.4x';

        // Datos de la hélice (256 posiciones PCA)
        const posPCAData = [{"x":0.445,"y":0.991,"z":-3.132},{"x":0.145,"y":0.006,"z":-2.423},{"x":0.172,"y":-0.178,"z":-2.444},{"x":0.129,"y":-0.164,"z":-2.441},{"x":0.003,"y":-0.216,"z":-2.467},{"x":-0.122,"y":-0.256,"z":-2.475},{"x":-0.237,"y":-0.26,"z":-2.492},{"x":-0.348,"y":-0.243,"z":-2.502},{"x":-0.453,"y":-0.201,"z":-2.511},{"x":-0.549,"y":-0.151,"z":-2.523},{"x":-0.622,"y":-0.094,"z":-2.532},{"x":-0.704,"y":-0.026,"z":-2.528},{"x":-0.767,"y":0.046,"z":-2.539},{"x":-0.819,"y":0.107,"z":-2.527},{"x":-0.863,"y":0.182,"z":-2.524},{"x":-0.906,"y":0.256,"z":-2.516},{"x":-0.942,"y":0.335,"z":-2.509},{"x":-0.962,"y":0.403,"z":-2.503},{"x":-0.991,"y":0.488,"z":-2.491},{"x":-1.002,"y":0.561,"z":-2.484},{"x":-1.013,"y":0.635,"z":-2.468},{"x":-1.014,"y":0.708,"z":-2.456},{"x":-1.002,"y":0.783,"z":-2.436},{"x":-1.0,"y":0.857,"z":-2.418},{"x":-0.983,"y":0.925,"z":-2.41},{"x":-0.967,"y":1.0,"z":-2.398},{"x":-0.948,"y":1.065,"z":-2.383},{"x":-0.922,"y":1.131,"z":-2.364},{"x":-0.905,"y":1.19,"z":-2.339},{"x":-0.878,"y":1.257,"z":-2.33},{"x":-0.848,"y":1.315,"z":-2.313},{"x":-0.815,"y":1.376,"z":-2.3},{"x":-0.781,"y":1.425,"z":-2.279},{"x":-0.745,"y":1.477,"z":-2.255},{"x":-0.708,"y":1.526,"z":-2.243},{"x":-0.668,"y":1.57,"z":-2.219},{"x":-0.62,"y":1.616,"z":-2.213},{"x":-0.576,"y":1.656,"z":-2.191},{"x":-0.531,"y":1.697,"z":-2.178},{"x":-0.478,"y":1.737,"z":-2.157},{"x":-0.426,"y":1.768,"z":-2.15},{"x":-0.373,"y":1.801,"z":-2.133},{"x":-0.322,"y":1.831,"z":-2.119},{"x":-0.266,"y":1.852,"z":-2.108},{"x":-0.203,"y":1.864,"z":-2.095},{"x":-0.147,"y":1.892,"z":-2.083},{"x":-0.087,"y":1.911,"z":-2.074},{"x":-0.026,"y":1.927,"z":-2.068},{"x":0.033,"y":1.94,"z":-2.055},{"x":0.096,"y":1.957,"z":-2.045},{"x":0.153,"y":1.963,"z":-2.04},{"x":0.214,"y":1.968,"z":-2.032},{"x":0.272,"y":1.969,"z":-2.02},{"x":0.329,"y":1.973,"z":-2.014},{"x":0.39,"y":1.973,"z":-2.003},{"x":0.446,"y":1.978,"z":-2.006},{"x":0.502,"y":1.971,"z":-1.994},{"x":0.555,"y":1.972,"z":-1.989},{"x":0.608,"y":1.975,"z":-1.984},{"x":0.658,"y":1.962,"z":-1.983},{"x":0.71,"y":1.951,"z":-1.978},{"x":0.76,"y":1.935,"z":-1.972},{"x":0.806,"y":1.924,"z":-1.964},{"x":0.854,"y":1.909,"z":-1.96},{"x":0.902,"y":1.899,"z":-1.96},{"x":0.949,"y":1.881,"z":-1.965},{"x":0.992,"y":1.865,"z":-1.961},{"x":1.035,"y":1.839,"z":-1.954},{"x":1.082,"y":1.825,"z":-1.956},{"x":1.123,"y":1.802,"z":-1.958},{"x":1.165,"y":1.776,"z":-1.947},{"x":1.212,"y":1.762,"z":-1.953},{"x":1.256,"y":1.735,"z":-1.945},{"x":1.293,"y":1.701,"z":-1.952},{"x":1.331,"y":1.677,"z":-1.951},{"x":1.377,"y":1.647,"z":-1.954},{"x":1.419,"y":1.62,"z":-1.952},{"x":1.457,"y":1.59,"z":-1.944},{"x":1.493,"y":1.561,"z":-1.944},{"x":1.526,"y":1.521,"z":-1.943},{"x":1.567,"y":1.488,"z":-1.944},{"x":1.601,"y":1.458,"z":-1.936},{"x":1.642,"y":1.428,"z":-1.937},{"x":1.675,"y":1.399,"z":-1.942},{"x":1.709,"y":1.356,"z":-1.943},{"x":1.744,"y":1.319,"z":-1.935},{"x":1.772,"y":1.285,"z":-1.938},{"x":1.811,"y":1.26,"z":-1.935},{"x":1.84,"y":1.223,"z":-1.938},{"x":1.865,"y":1.182,"z":-1.936},{"x":1.892,"y":1.145,"z":-1.942},{"x":1.924,"y":1.111,"z":-1.947},{"x":1.952,"y":1.076,"z":-1.944},{"x":1.977,"y":1.037,"z":-1.948},{"x":1.997,"y":1.002,"z":-1.941},{"x":2.015,"y":0.962,"z":-1.95},{"x":2.045,"y":0.923,"z":-1.951},{"x":2.06,"y":0.884,"z":-1.952},{"x":2.08,"y":0.839,"z":-1.954},{"x":2.101,"y":0.81,"z":-1.963},{"x":2.121,"y":0.771,"z":-1.967},{"x":2.138,"y":0.731,"z":-1.971},{"x":2.145,"y":0.692,"z":-1.969},{"x":2.167,"y":0.653,"z":-1.974},{"x":2.172,"y":0.606,"z":-1.977},{"x":2.19,"y":0.569,"z":-1.976},{"x":2.197,"y":0.53,"z":-1.979},{"x":2.209,"y":0.491,"z":-1.978},{"x":2.222,"y":0.45,"z":-1.986},{"x":2.236,"y":0.405,"z":-1.994},{"x":2.239,"y":0.364,"z":-1.989},{"x":2.251,"y":0.327,"z":-1.991},{"x":2.252,"y":0.282,"z":-1.997},{"x":2.266,"y":0.242,"z":-2.004},{"x":2.265,"y":0.203,"z":-1.998},{"x":2.268,"y":0.159,"z":-2.003},{"x":2.269,"y":0.12,"z":-2.006},{"x":2.275,"y":0.072,"z":-2.003},{"x":2.277,"y":0.03,"z":-2.012},{"x":2.272,"y":-0.01,"z":-2.01},{"x":2.275,"y":-0.049,"z":-2.015},{"x":2.263,"y":-0.095,"z":-2.013},{"x":2.266,"y":-0.137,"z":-2.019},{"x":2.267,"y":-0.179,"z":-2.016},{"x":2.266,"y":-0.214,"z":-2.023},{"x":2.258,"y":-0.258,"z":-2.028},{"x":2.254,"y":-0.305,"z":-2.025},{"x":2.251,"y":-0.348,"z":-2.021},{"x":2.239,"y":-0.382,"z":-2.028},{"x":2.233,"y":-0.429,"z":-2.032},{"x":2.226,"y":-0.466,"z":-2.031},{"x":2.21,"y":-0.506,"z":-2.031},{"x":2.197,"y":-0.543,"z":-2.039},{"x":2.19,"y":-0.587,"z":-2.035},{"x":2.183,"y":-0.628,"z":-2.04},{"x":2.162,"y":-0.665,"z":-2.033},{"x":2.154,"y":-0.707,"z":-2.04},{"x":2.148,"y":-0.743,"z":-2.033},{"x":2.127,"y":-0.778,"z":-2.041},{"x":2.109,"y":-0.818,"z":-2.039},{"x":2.1,"y":-0.861,"z":-2.049},{"x":2.077,"y":-0.896,"z":-2.042},{"x":2.062,"y":-0.929,"z":-2.044},{"x":2.047,"y":-0.971,"z":-2.046},{"x":2.023,"y":-1.003,"z":-2.047},{"x":2.0,"y":-1.039,"z":-2.051},{"x":1.981,"y":-1.071,"z":-2.055},{"x":1.958,"y":-1.104,"z":-2.059},{"x":1.943,"y":-1.148,"z":-2.058},{"x":1.917,"y":-1.17,"z":-2.066},{"x":1.891,"y":-1.203,"z":-2.066},{"x":1.868,"y":-1.235,"z":-2.072},{"x":1.843,"y":-1.268,"z":-2.07},{"x":1.825,"y":-1.302,"z":-2.077},{"x":1.788,"y":-1.329,"z":-2.076},{"x":1.765,"y":-1.364,"z":-2.085},{"x":1.735,"y":-1.395,"z":-2.083},{"x":1.709,"y":-1.421,"z":-2.087},{"x":1.676,"y":-1.447,"z":-2.096},{"x":1.649,"y":-1.48,"z":-2.101},{"x":1.621,"y":-1.504,"z":-2.098},{"x":1.584,"y":-1.526,"z":-2.099},{"x":1.564,"y":-1.557,"z":-2.115},{"x":1.534,"y":-1.581,"z":-2.11},{"x":1.502,"y":-1.605,"z":-2.118},{"x":1.468,"y":-1.629,"z":-2.12},{"x":1.438,"y":-1.654,"z":-2.126},{"x":1.402,"y":-1.676,"z":-2.126},{"x":1.369,"y":-1.7,"z":-2.131},{"x":1.341,"y":-1.719,"z":-2.131},{"x":1.305,"y":-1.747,"z":-2.138},{"x":1.265,"y":-1.762,"z":-2.143},{"x":1.238,"y":-1.783,"z":-2.144},{"x":1.204,"y":-1.801,"z":-2.146},{"x":1.17,"y":-1.821,"z":-2.147},{"x":1.132,"y":-1.841,"z":-2.151},{"x":1.097,"y":-1.863,"z":-2.157},{"x":1.064,"y":-1.873,"z":-2.152},{"x":1.027,"y":-1.895,"z":-2.158},{"x":0.995,"y":-1.905,"z":-2.156},{"x":0.95,"y":-1.917,"z":-2.166},{"x":0.917,"y":-1.931,"z":-2.164},{"x":0.883,"y":-1.951,"z":-2.173},{"x":0.845,"y":-1.958,"z":-2.17},{"x":0.805,"y":-1.972,"z":-2.172},{"x":0.772,"y":-1.984,"z":-2.18},{"x":0.734,"y":-1.993,"z":-2.176},{"x":0.696,"y":-1.999,"z":-2.188},{"x":0.657,"y":-2.016,"z":-2.19},{"x":0.624,"y":-2.026,"z":-2.185},{"x":0.586,"y":-2.032,"z":-2.179},{"x":0.55,"y":-2.04,"z":-2.183},{"x":0.508,"y":-2.043,"z":-2.19},{"x":0.476,"y":-2.056,"z":-2.195},{"x":0.437,"y":-2.061,"z":-2.194},{"x":0.4,"y":-2.064,"z":-2.191},{"x":0.358,"y":-2.065,"z":-2.197},{"x":0.318,"y":-2.065,"z":-2.194},{"x":0.281,"y":-2.073,"z":-2.2},{"x":0.245,"y":-2.075,"z":-2.2},{"x":0.203,"y":-2.085,"z":-2.206},{"x":0.166,"y":-2.086,"z":-2.202},{"x":0.127,"y":-2.088,"z":-2.202},{"x":0.09,"y":-2.088,"z":-2.209},{"x":0.054,"y":-2.088,"z":-2.205},{"x":0.013,"y":-2.08,"z":-2.205},{"x":-0.024,"y":-2.091,"z":-2.21},{"x":-0.059,"y":-2.09,"z":-2.21},{"x":-0.102,"y":-2.082,"z":-2.207},{"x":-0.138,"y":-2.087,"z":-2.202},{"x":-0.174,"y":-2.078,"z":-2.205},{"x":-0.204,"y":-2.083,"z":-2.207},{"x":-0.246,"y":-2.083,"z":-2.205},{"x":-0.282,"y":-2.073,"z":-2.201},{"x":-0.317,"y":-2.069,"z":-2.199},{"x":-0.355,"y":-2.067,"z":-2.2},{"x":-0.394,"y":-2.059,"z":-2.188},{"x":-0.43,"y":-2.062,"z":-2.187},{"x":-0.464,"y":-2.055,"z":-2.194},{"x":-0.497,"y":-2.043,"z":-2.193},{"x":-0.538,"y":-2.039,"z":-2.184},{"x":-0.573,"y":-2.031,"z":-2.188},{"x":-0.608,"y":-2.018,"z":-2.181},{"x":-0.642,"y":-2.014,"z":-2.177},{"x":-0.675,"y":-1.995,"z":-2.185},{"x":-0.71,"y":-1.984,"z":-2.178},{"x":-0.746,"y":-1.98,"z":-2.171},{"x":-0.778,"y":-1.97,"z":-2.17},{"x":-0.815,"y":-1.957,"z":-2.164},{"x":-0.849,"y":-1.941,"z":-2.161},{"x":-0.886,"y":-1.937,"z":-2.157},{"x":-0.911,"y":-1.923,"z":-2.147},{"x":-0.945,"y":-1.912,"z":-2.148},{"x":-0.985,"y":-1.894,"z":-2.148},{"x":-1.012,"y":-1.879,"z":-2.145},{"x":-1.04,"y":-1.868,"z":-2.139},{"x":-1.081,"y":-1.854,"z":-2.131},{"x":-1.106,"y":-1.841,"z":-2.13},{"x":-1.143,"y":-1.82,"z":-2.128},{"x":-1.175,"y":-1.803,"z":-2.115},{"x":-1.203,"y":-1.787,"z":-2.118},{"x":-1.234,"y":-1.769,"z":-2.111},{"x":-1.271,"y":-1.76,"z":-2.106},{"x":-1.294,"y":-1.733,"z":-2.101},{"x":-1.327,"y":-1.718,"z":-2.097},{"x":-1.354,"y":-1.701,"z":-2.086},{"x":-1.385,"y":-1.675,"z":-2.093},{"x":-1.415,"y":-1.668,"z":-2.082},{"x":-1.437,"y":-1.636,"z":-2.071},{"x":-1.472,"y":-1.624,"z":-2.066},{"x":-1.495,"y":-1.605,"z":-2.06},{"x":-1.526,"y":-1.579,"z":-2.055},{"x":-1.551,"y":-1.564,"z":-2.049},{"x":-1.58,"y":-1.535,"z":-2.044},{"x":-1.611,"y":-1.521,"z":-2.037},{"x":-1.638,"y":-1.497,"z":-2.031},{"x":-1.665,"y":-1.483,"z":-2.018},{"x":-1.689,"y":-1.457,"z":-2.011},{"x":-1.721,"y":-1.436,"z":-2.006},{"x":-1.749,"y":-1.415,"z":-2.005},{"x":-1.774,"y":-1.393,"z":-1.995},{"x":-1.798,"y":-1.361,"z":-1.992},{"x":-1.824,"y":-1.343,"z":-1.985},{"x":-1.845,"y":-1.314,"z":-1.971},{"x":-1.874,"y":-1.296,"z":-1.966},{"x":-1.903,"y":-1.276,"z":-1.959},{"x":-1.926,"y":-1.252,"z":-1.948},{"x":-1.951,"y":-1.226,"z":-1.94},{"x":-1.974,"y":-1.205,"z":-1.932},{"x":-1.997,"y":-1.179,"z":-1.923},{"x":-2.026,"y":-1.156,"z":-1.914},{"x":-2.045,"y":-1.131,"z":-1.906},{"x":-2.07,"y":-1.103,"z":-1.9},{"x":-2.095,"y":-1.088,"z":-1.888},{"x":-2.118,"y":-1.058,"z":-1.876},{"x":-2.141,"y":-1.031,"z":-1.871},{"x":-2.161,"y":-1.009,"z":-1.862},{"x":-2.182,"y":-0.98,"z":-1.853},{"x":-2.202,"y":-0.958,"z":-1.842},{"x":-2.227,"y":-0.93,"z":-1.834},{"x":-2.242,"y":-0.907,"z":-1.823},{"x":-2.27,"y":-0.88,"z":-1.821},{"x":-2.291,"y":-0.852,"z":-1.807},{"x":-2.317,"y":-0.831,"z":-1.799},{"x":-2.335,"y":-0.812,"z":-1.789},{"x":-2.348,"y":-0.774,"z":-1.777},{"x":-2.362,"y":-0.74,"z":-1.775},{"x":-2.384,"y":-0.708,"z":-1.762},{"x":-2.398,"y":-0.688,"z":-1.75},{"x":-2.418,"y":-0.66,"z":-1.736},{"x":-2.437,"y":-0.63,"z":-1.727},{"x":-2.457,"y":-0.598,"z":-1.722},{"x":-2.467,"y":-0.571,"z":-1.713},{"x":-2.487,"y":-0.543,"z":-1.7},{"x":-2.496,"y":-0.518,"z":-1.686},{"x":-2.514,"y":-0.491,"z":-1.681},{"x":-2.526,"y":-0.461,"z":-1.667},{"x":-2.544,"y":-0.424,"z":-1.66},{"x":-2.556,"y":-0.404,"z":-1.647},{"x":-2.569,"y":-0.371,"z":-1.636},{"x":-2.583,"y":-0.345,"z":-1.624},{"x":-2.594,"y":-0.309,"z":-1.617},{"x":-2.609,"y":-0.28,"z":-1.605},{"x":-2.616,"y":-0.249,"z":-1.594},{"x":-2.629,"y":-0.221,"z":-1.584},{"x":-2.64,"y":-0.192,"z":-1.576},{"x":-2.649,"y":-0.153,"z":-1.566},{"x":-2.654,"y":-0.13,"z":-1.55},{"x":-2.663,"y":-0.099,"z":-1.541},{"x":-2.674,"y":-0.071,"z":-1.528},{"x":-2.686,"y":-0.04,"z":-1.518},{"x":-2.694,"y":-0.012,"z":-1.507},{"x":-2.701,"y":0.023,"z":-1.499},{"x":-2.708,"y":0.048,"z":-1.48},{"x":-2.713,"y":0.082,"z":-1.475},{"x":-2.721,"y":0.117,"z":-1.464},{"x":-2.725,"y":0.147,"z":-1.455},{"x":-2.733,"y":0.177,"z":-1.444},{"x":-2.733,"y":0.209,"z":-1.432},{"x":-2.744,"y":0.241,"z":-1.422},{"x":-2.744,"y":0.269,"z":-1.401},{"x":-2.753,"y":0.297,"z":-1.393},{"x":-2.756,"y":0.325,"z":-1.384},{"x":-2.757,"y":0.358,"z":-1.373},{"x":-2.754,"y":0.395,"z":-1.362},{"x":-2.756,"y":0.422,"z":-1.347},{"x":-2.766,"y":0.45,"z":-1.343},{"x":-2.764,"y":0.481,"z":-1.329},{"x":-2.768,"y":0.518,"z":-1.318},{"x":-2.765,"y":0.541,"z":-1.301},{"x":-2.774,"y":0.58,"z":-1.295},{"x":-2.766,"y":0.606,"z":-1.28},{"x":-2.767,"y":0.636,"z":-1.272},{"x":-2.771,"y":0.669,"z":-1.257},{"x":-2.762,"y":0.697,"z":-1.246},{"x":-2.764,"y":0.729,"z":-1.235},{"x":-2.762,"y":0.753,"z":-1.224},{"x":-2.759,"y":0.786,"z":-1.209},{"x":-2.755,"y":0.818,"z":-1.202},{"x":-2.751,"y":0.852,"z":-1.191},{"x":-2.747,"y":0.883,"z":-1.176},{"x":-2.742,"y":0.911,"z":-1.17},{"x":-2.736,"y":0.942,"z":-1.155},{"x":-2.725,"y":0.97,"z":-1.139},{"x":-2.727,"y":0.998,"z":-1.128},{"x":-2.713,"y":1.026,"z":-1.118},{"x":-2.714,"y":1.067,"z":-1.111},{"x":-2.702,"y":1.09,"z":-1.095},{"x":-2.7,"y":1.12,"z":-1.08},{"x":-2.691,"y":1.151,"z":-1.074},{"x":-2.679,"y":1.185,"z":-1.063},{"x":-2.671,"y":1.207,"z":-1.05},{"x":-2.667,"y":1.24,"z":-1.041},{"x":-2.656,"y":1.27,"z":-1.027},{"x":-2.65,"y":1.296,"z":-1.015},{"x":-2.634,"y":1.328,"z":-1.0},{"x":-2.625,"y":1.362,"z":-0.996},{"x":-2.613,"y":1.388,"z":-0.981},{"x":-2.605,"y":1.414,"z":-0.971},{"x":-2.595,"y":1.448,"z":-0.962},{"x":-2.584,"y":1.47,"z":-0.944},{"x":-2.568,"y":1.508,"z":-0.934},{"x":-2.56,"y":1.539,"z":-0.929},{"x":-2.54,"y":1.56,"z":-0.908},{"x":-2.529,"y":1.59,"z":-0.901},{"x":-2.514,"y":1.622,"z":-0.89},{"x":-2.5,"y":1.648,"z":-0.873},{"x":-2.488,"y":1.676,"z":-0.859},{"x":-2.477,"y":1.707,"z":-0.851},{"x":-2.462,"y":1.737,"z":-0.839},{"x":-2.452,"y":1.761,"z":-0.825},{"x":-2.428,"y":1.784,"z":-0.815},{"x":-2.416,"y":1.819,"z":-0.802},{"x":-2.406,"y":1.841,"z":-0.783},{"x":-2.385,"y":1.872,"z":-0.778},{"x":-2.368,"y":1.89,"z":-0.764},{"x":-2.347,"y":1.919,"z":-0.752},{"x":-2.331,"y":1.948,"z":-0.735},{"x":-2.312,"y":1.973,"z":-0.726},{"x":-2.301,"y":2.0,"z":-0.711},{"x":-2.274,"y":2.024,"z":-0.701},{"x":-2.258,"y":2.045,"z":-0.689},{"x":-2.24,"y":2.073,"z":-0.678},{"x":-2.22,"y":2.098,"z":-0.67},{"x":-2.198,"y":2.12,"z":-0.648},{"x":-2.18,"y":2.146,"z":-0.639},{"x":-2.167,"y":2.17,"z":-0.625},{"x":-2.152,"y":2.196,"z":-0.612},{"x":-2.123,"y":2.218,"z":-0.605},{"x":-2.099,"y":2.238,"z":-0.59},{"x":-2.083,"y":2.264,"z":-0.577},{"x":-2.061,"y":2.284,"z":-0.563},{"x":-2.039,"y":2.312,"z":-0.55},{"x":-2.02,"y":2.334,"z":-0.536},{"x":-2.0,"y":2.351,"z":-0.525},{"x":-1.973,"y":2.375,"z":-0.513},{"x":-1.949,"y":2.396,"z":-0.5},{"x":-1.934,"y":2.421,"z":-0.491},{"x":-1.911,"y":2.441,"z":-0.479},{"x":-1.882,"y":2.457,"z":-0.463},{"x":-1.86,"y":2.479,"z":-0.447},{"x":-1.839,"y":2.495,"z":-0.437},{"x":-1.814,"y":2.517,"z":-0.428},{"x":-1.791,"y":2.534,"z":-0.416},{"x":-1.767,"y":2.559,"z":-0.405},{"x":-1.744,"y":2.573,"z":-0.391},{"x":-1.716,"y":2.587,"z":-0.378},{"x":-1.693,"y":2.61,"z":-0.365},{"x":-1.662,"y":2.626,"z":-0.355},{"x":-1.642,"y":2.643,"z":-0.343},{"x":-1.616,"y":2.662,"z":-0.337},{"x":-1.59,"y":2.681,"z":-0.323},{"x":-1.564,"y":2.696,"z":-0.307},{"x":-1.534,"y":2.71,"z":-0.298},{"x":-1.513,"y":2.722,"z":-0.284},{"x":-1.482,"y":2.743,"z":-0.276},{"x":-1.458,"y":2.755,"z":-0.263},{"x":-1.428,"y":2.772,"z":-0.25},{"x":-1.402,"y":2.785,"z":-0.239},{"x":-1.378,"y":2.799,"z":-0.228},{"x":-1.354,"y":2.82,"z":-0.215},{"x":-1.321,"y":2.83,"z":-0.203},{"x":-1.291,"y":2.846,"z":-0.194},{"x":-1.269,"y":2.856,"z":-0.185},{"x":-1.237,"y":2.87,"z":-0.173},{"x":-1.211,"y":2.878,"z":-0.161},{"x":-1.183,"y":2.894,"z":-0.151},{"x":-1.156,"y":2.912,"z":-0.134},{"x":-1.133,"y":2.919,"z":-0.123},{"x":-1.101,"y":2.932,"z":-0.12},{"x":-1.075,"y":2.94,"z":-0.101},{"x":-1.049,"y":2.95,"z":-0.085},{"x":-1.017,"y":2.962,"z":-0.079},{"x":-0.989,"y":2.98,"z":-0.069},{"x":-0.958,"y":2.984,"z":-0.063},{"x":-0.931,"y":2.99,"z":-0.048},{"x":-0.904,"y":3.0,"z":-0.037},{"x":-0.871,"y":3.011,"z":-0.03},{"x":-0.845,"y":3.017,"z":-0.016},{"x":-0.82,"y":3.026,"z":-0.007},{"x":-0.783,"y":3.034,"z":0.001},{"x":-0.755,"y":3.046,"z":0.011},{"x":-0.728,"y":3.051,"z":0.022},{"x":-0.697,"y":3.053,"z":0.032},{"x":-0.668,"y":3.068,"z":0.042},{"x":-0.643,"y":3.076,"z":0.054},{"x":-0.612,"y":3.08,"z":0.063},{"x":-0.581,"y":3.086,"z":0.072},{"x":-0.551,"y":3.093,"z":0.085},{"x":-0.513,"y":3.091,"z":0.091},{"x":-0.486,"y":3.098,"z":0.101},{"x":-0.465,"y":3.11,"z":0.116},{"x":-0.434,"y":3.108,"z":0.128},{"x":-0.399,"y":3.114,"z":0.13},{"x":-0.368,"y":3.116,"z":0.142},{"x":-0.337,"y":3.12,"z":0.151},{"x":-0.309,"y":3.126,"z":0.16},{"x":-0.281,"y":3.135,"z":0.167},{"x":-0.252,"y":3.131,"z":0.173},{"x":-0.219,"y":3.142,"z":0.191},{"x":-0.186,"y":3.135,"z":0.201},{"x":-0.153,"y":3.136,"z":0.202},{"x":-0.13,"y":3.143,"z":0.215},{"x":-0.098,"y":3.139,"z":0.226},{"x":-0.071,"y":3.147,"z":0.236},{"x":-0.037,"y":3.143,"z":0.244},{"x":-0.005,"y":3.143,"z":0.251},{"x":0.023,"y":3.148,"z":0.261},{"x":0.057,"y":3.148,"z":0.269},{"x":0.081,"y":3.147,"z":0.282},{"x":0.114,"y":3.149,"z":0.286},{"x":0.147,"y":3.147,"z":0.292},{"x":0.175,"y":3.151,"z":0.305},{"x":0.209,"y":3.143,"z":0.314},{"x":0.238,"y":3.138,"z":0.322},{"x":0.268,"y":3.139,"z":0.329},{"x":0.298,"y":3.131,"z":0.335},{"x":0.332,"y":3.127,"z":0.342},{"x":0.36,"y":3.131,"z":0.352},{"x":0.39,"y":3.121,"z":0.364},{"x":0.423,"y":3.124,"z":0.365},{"x":0.453,"y":3.119,"z":0.378},{"x":0.479,"y":3.11,"z":0.388},{"x":0.513,"y":3.106,"z":0.392},{"x":0.54,"y":3.105,"z":0.404},{"x":0.572,"y":3.102,"z":0.412},{"x":0.605,"y":3.094,"z":0.414},{"x":0.627,"y":3.081,"z":0.428},{"x":0.661,"y":3.075,"z":0.431},{"x":0.697,"y":3.072,"z":0.44},{"x":0.72,"y":3.058,"z":0.446},{"x":0.748,"y":3.056,"z":0.456},{"x":0.775,"y":3.045,"z":0.462},{"x":0.811,"y":3.043,"z":0.468},{"x":0.835,"y":3.034,"z":0.479},{"x":0.863,"y":3.027,"z":0.484},{"x":0.888,"y":3.016,"z":0.49},{"x":0.921,"y":3.007,"z":0.497},{"x":0.949,"y":2.998,"z":0.503},{"x":0.975,"y":2.985,"z":0.514},{"x":1.007,"y":2.984,"z":0.517},{"x":1.034,"y":2.96,"z":0.519},{"x":1.063,"y":2.949,"z":0.531},{"x":1.091,"y":2.941,"z":0.537},{"x":1.12,"y":2.93,"z":0.544},{"x":1.147,"y":2.921,"z":0.549},{"x":1.169,"y":2.907,"z":0.559},{"x":1.2,"y":2.894,"z":0.566},{"x":1.224,"y":2.881,"z":0.57},{"x":1.254,"y":2.877,"z":0.575},{"x":1.277,"y":2.864,"z":0.583},{"x":1.305,"y":2.85,"z":0.589}];

        // Datos de Atención vs MLP (ejemplo simplificado)
        const attnData = [];
        const mlpData = [];
        for (let i = 0; i < 100; i++) {
            attnData.push({x: -0.5 + Math.random() * 0.8, y: 0.1 + Math.random() * 0.5});
            mlpData.push({x: 0.1 + Math.random() * 0.8, y: -0.5 + Math.random() * 0.6});
        }

        // Datos de evolución de capas (ejemplo)
        const layerEvolution = [
            {x: -0.8, y: -0.3}, {x: -0.6, y: -0.25}, {x: -0.4, y: -0.2},
            {x: -0.2, y: -0.1}, {x: 0, y: 0}, {x: 0.15, y: 0.1},
            {x: 0.3, y: 0.15}, {x: 0.4, y: 0.2}, {x: 0.5, y: 0.22},
            {x: 0.55, y: 0.25}, {x: 0.6, y: 0.27}, {x: 0.65, y: 0.3}
        ];

        // ============================================
        // CHART.JS - Gráficos 2D
        // ============================================
        Chart.defaults.color = '#e0e0e0';
        Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';

        // Norma por Posición
        new Chart(document.getElementById('normByPos'), {
            type: 'bar',
            data: {
                labels: normByPosData.map((_, i) => i),
                datasets: [{
                    data: normByPosData,
                    backgroundColor: normByPosData.map((_, i) => i === 0 ? 'rgba(244, 67, 54, 0.8)' : 'rgba(79, 195, 247, 0.6)'),
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { title: { display: true, text: 'Norma Promedio' } },
                    x: { title: { display: true, text: 'Posición' } }
                }
            }
        });

        // Norma por Capa
        new Chart(document.getElementById('normByLayer'), {
            type: 'bar',
            data: {
                labels: normByLayerData.map((_, i) => `L${i}`),
                datasets: [{
                    data: normByLayerData,
                    backgroundColor: normByLayerData.map((_, i) => {
                        const t = i / normByLayerData.length;
                        return i % 2 === 0 ?
                            `rgba(79, 195, 247, ${0.4 + t * 0.5})` :
                            `rgba(244, 67, 54, ${0.4 + t * 0.5})`;
                    }),
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { title: { display: true, text: 'Norma Promedio' } },
                    x: { title: { display: true, text: 'Capa' } }
                }
            }
        });

        // Atención vs MLP
        new Chart(document.getElementById('attnMLP'), {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Atención',
                    data: attnData,
                    backgroundColor: 'rgba(79, 195, 247, 0.5)',
                    pointRadius: 4
                }, {
                    label: 'MLP',
                    data: mlpData,
                    backgroundColor: 'rgba(244, 67, 54, 0.5)',
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'top' } },
                scales: {
                    x: { title: { display: true, text: 'PC1' } },
                    y: { title: { display: true, text: 'PC2' } }
                }
            }
        });

        // Evolución de Capas
        new Chart(document.getElementById('layerPCA'), {
            type: 'scatter',
            data: {
                datasets: [{
                    data: layerEvolution,
                    backgroundColor: layerEvolution.map((_, i) => {
                        const t = i / layerEvolution.length;
                        return `rgba(${50 + t * 200}, ${150 + t * 50}, ${200 - t * 150}, 0.8)`;
                    }),
                    pointRadius: 8
                }, {
                    data: layerEvolution,
                    type: 'line',
                    borderColor: 'rgba(255,255,255,0.3)',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    x: { title: { display: true, text: 'PC1' } },
                    y: { title: { display: true, text: 'PC2' } }
                }
            }
        });

        // ============================================
        // THREE.JS - Hélice 3D
        // ============================================
        (function() {
            const container = document.getElementById('helix-3d-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0d1117);

            const camera = new THREE.PerspectiveCamera(60, width/height, 0.1, 1000);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            container.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // Calcular centro y bounds
            let minX = Infinity, maxX = -Infinity;
            let minY = Infinity, maxY = -Infinity;
            let minZ = Infinity, maxZ = -Infinity;

            for (const p of posPCAData) {
                minX = Math.min(minX, p.x); maxX = Math.max(maxX, p.x);
                minY = Math.min(minY, p.y); maxY = Math.max(maxY, p.y);
                minZ = Math.min(minZ, p.z); maxZ = Math.max(maxZ, p.z);
            }

            const centerX = (minX + maxX) / 2;
            const centerY = (minY + maxY) / 2;
            const centerZ = (minZ + maxZ) / 2;
            const maxRange = Math.max(maxX - minX, maxY - minY, maxZ - minZ);

            // Crear puntos
            const positions = [];
            const colors = [];

            for (let i = 0; i < posPCAData.length; i++) {
                positions.push(
                    posPCAData[i].x - centerX,
                    posPCAData[i].y - centerY,
                    posPCAData[i].z - centerZ
                );
                const t = i / posPCAData.length;
                colors.push(0.2 + t * 0.8, 0.6 + t * 0.4, 1.0 - t * 0.7);
            }

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: 0.2,
                vertexColors: true,
                sizeAttenuation: true
            });

            const points = new THREE.Points(geometry, material);
            scene.add(points);

            // Línea
            const lineGeom = new THREE.BufferGeometry();
            lineGeom.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            const lineMat = new THREE.LineBasicMaterial({ color: 0x6688ff, opacity: 0.5, transparent: true });
            const line = new THREE.Line(lineGeom, lineMat);
            scene.add(line);

            // Ejes
            const axes = new THREE.AxesHelper(maxRange * 0.8);
            scene.add(axes);

            // Cámara
            camera.position.set(maxRange * 1.2, maxRange * 1.2, maxRange * 1.2);
            camera.lookAt(0, 0, 0);
            controls.target.set(0, 0, 0);

            // Luz
            scene.add(new THREE.AmbientLight(0xffffff, 0.8));

            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                const w = container.clientWidth;
                const h = container.clientHeight;
                camera.aspect = w / h;
                camera.updateProjectionMatrix();
                renderer.setSize(w, h);
            });
        })();

        // ============================================
        // CANVAS 2D - Vistas de la Hélice
        // ============================================
        function drawView2D(canvasId, getX, getY, axisLabelX, axisLabelY) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            const padding = 40;

            let minX = Infinity, maxX = -Infinity;
            let minY = Infinity, maxY = -Infinity;

            for (const p of posPCAData) {
                const x = getX(p);
                const y = getY(p);
                minX = Math.min(minX, x); maxX = Math.max(maxX, x);
                minY = Math.min(minY, y); maxY = Math.max(maxY, y);
            }

            const rangeX = maxX - minX || 1;
            const rangeY = maxY - minY || 1;
            minX -= rangeX * 0.1; maxX += rangeX * 0.1;
            minY -= rangeY * 0.1; maxY += rangeY * 0.1;

            const mapX = (val) => padding + (val - minX) / (maxX - minX) * (w - 2 * padding);
            const mapY = (val) => h - padding - (val - minY) / (maxY - minY) * (h - 2 * padding);

            ctx.fillStyle = '#0d1117';
            ctx.fillRect(0, 0, w, h);

            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, h - padding);
            ctx.lineTo(w - padding, h - padding);
            ctx.moveTo(padding, h - padding);
            ctx.lineTo(padding, padding);
            ctx.stroke();

            ctx.fillStyle = '#888';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(axisLabelX, w / 2, h - 8);
            ctx.save();
            ctx.translate(12, h / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText(axisLabelY, 0, 0);
            ctx.restore();

            ctx.strokeStyle = 'rgba(100, 150, 255, 0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            for (let i = 0; i < posPCAData.length; i++) {
                const x = mapX(getX(posPCAData[i]));
                const y = mapY(getY(posPCAData[i]));
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            for (let i = 0; i < posPCAData.length; i++) {
                const p = posPCAData[i];
                const x = mapX(getX(p));
                const y = mapY(getY(p));
                const t = i / posPCAData.length;
                const r = Math.floor(50 + t * 200);
                const g = Math.floor(150 + t * 80);
                const b = Math.floor(255 - t * 200);

                ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                ctx.beginPath();
                ctx.arc(x, y, 2.5, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        drawView2D('canvas-xy', p => p.x, p => p.y, 'PC1', 'PC2');
        drawView2D('canvas-xz', p => p.x, p => p.z, 'PC1', 'PC3');
        drawView2D('canvas-yz', p => p.y, p => p.z, 'PC2', 'PC3');
    </script>
</body>
</html>
